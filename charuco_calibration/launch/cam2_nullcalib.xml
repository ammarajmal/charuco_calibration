<launch>
  <!-- Calibration launch for Camera 2 using 8×11 ChArUco board -->

  <!-- Camera streaming (no prior calibration) -->
  <arg name="camera_name"   default="sony_cam2"/>
  <arg name="camera_id"     default="2"/>
  <arg name="camera_fps"    default="60"/>
  <!-- Disable built-in calibration to capture raw images -->
  <arg name="camera_calib"  default="file:///dev/null"/>
  <arg name="image_width"   default="1920"/>
  <arg name="image_height"  default="1080"/>

  <node name="$(arg camera_name)" pkg="sony_cam" type="sony_cam_node" output="screen">
    <param name="frame_rate"      value="$(arg camera_fps)"/>
    <param name="camera_name"     value="$(arg camera_name)"/>
    <param name="camera_frame_id" value="$(arg camera_name)"/>
    <param name="device_id"       value="/dev/video_cam2"/>
    <param name="image_width"     value="$(arg image_width)"/>
    <param name="image_height"    value="$(arg image_height)"/>
    <param name="camera_info_url"  value="$(arg camera_calib)"/>
    <param name="calibration_file" value="$(arg camera_calib)"/>
  </node>

  <!-- ChArUco calibration node -->
  <node pkg="charuco_calibration" name="charuco_calibration_node" type="charuco_calibration_node" output="screen">
    <!-- Subscribe raw image stream -->
    <remap from="image" to="$(arg camera_name)/image_raw"/>

    <!-- Board geometry: 8 squares × 11 squares -->
    <param name="squares_x"      value="8"/>    <!-- columns -->
    <param name="squares_y"      value="11"/>   <!-- rows -->
    <param name="square_length"  value="0.015"/><!-- meters (15 mm) -->
    <param name="marker_length"  value="0.011"/><!-- meters (11 mm) -->

    <!-- ArUco dictionary: 4×4_50 -->
    <param name="dictionary_id"   value="0"/><!-- cv::aruco::DICT_4X4_50 -->

    <!-- Detection & refinement options -->
    <param name="perform_refinement"      value="true"/>
    <param name="draw_historical_markers" value="true"/>
    <param name="save_images"             value="true"/>

    <!-- Output calibration file -->
    <param name="output_file" value="~/calib_cam2/cam2_calibration.yaml"/>

    <!-- Optional: additional parameters from YAML -->
    <rosparam command="load" file="$(find charuco_calibration)/launch/calibration_params.yaml"/>
  </node>
</launch>
